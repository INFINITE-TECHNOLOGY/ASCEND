package io.infinite.ascend

import com.fasterxml.jackson.databind.ObjectMapper
import com.fasterxml.jackson.dataformat.yaml.YAMLFactory
import com.fasterxml.jackson.dataformat.yaml.YAMLGenerator
import io.infinite.ascend.common.JwtManager
import io.infinite.ascend.granting.model.Authorization
import io.jsonwebtoken.Jwt
import io.jsonwebtoken.Jwts
import io.jsonwebtoken.SignatureAlgorithm
import org.apache.shiro.codec.Hex
import org.junit.Test

import java.security.KeyFactory
import java.security.spec.X509EncodedKeySpec

class GzipTest {

    @Test
    void test() {
        JwtManager jwtManager = new JwtManager()
        X509EncodedKeySpec x509EncodedKeySpec = new X509EncodedKeySpec(Hex.decode("30820222300d06092a864886f70d01010105000382020f003082020a02820201009d789378cfb1e02606004ae9246e04299ead28b3bb4dabed959c5f98d05de015e3cc6f823e26890bb3eaca273cf61cdeada2cabb396529b7ba1fa24ef3d25a3a9aa3d834057612893da4614b9e6b395ea754cae2815dd3965534de6f7a484665ca8495861fcc37ed2eb0ee5c5e6ac6fd43942acdee656574019c981327a15029238301e569153ba7af51ea98f699398283470ebadb336f60c530f8e72e724183aeb010d43b1fb0f3087790f25ec5d3122e1156d951e27474211b09c3ce32aed3b17d0f0803953fe9624d84b7b0f3726557879558661f103728623616bd9fb8c49437868e861666857aef67e471296ee119c43d5817725264499fb33869cbad1971ebd78fac907749b9aa342390c5bb8ccb31e3763961e1aacfea8dd1574d7c1e28a4ee23af15a88820c58c431335a32cfaf9fa84bffbd27dbff3ab321a3d90d1e4e7499add3676eb645b28e853c8a23087babe7297f2eb1d11adbd2be7f9d4672a66a517f4a1965659fd3d039d592892d325bdfa576ae131ce81ec6b00d42315c271b0e1c2d0dba3742dfd84930344de75e26816c0efd66991923dbdc7e40181043ab1c8fc50b1b5e2e64208c7a3b8ea027643dacedce1d8a71d1f2d550da096e948535405510dcf083e119f66c9ed6b3f04d69ff3870f170222c8b2561818401c7d62bfa1876a3e2f5d71195b3083d63525ba9859ea03b32e02db57b25b80f30203010001"))
        jwtManager.jwtAccessKeyPublic = KeyFactory.getInstance(SignatureAlgorithm.RS512.getFamilyName()).generatePublic(x509EncodedKeySpec)
        YAMLFactory yamlFactory = new YAMLFactory()
        yamlFactory.enable(YAMLGenerator.Feature.MINIMIZE_QUOTES)
        yamlFactory.disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER)
        yamlFactory.disable(YAMLGenerator.Feature.SPLIT_LINES)
        yamlFactory.enable(YAMLGenerator.Feature.INDENT_ARRAYS)
        jwtManager.objectMapper = new ObjectMapper(yamlFactory)
        Jwt jwt = Jwts.parser().setSigningKey(jwtManager.jwtAccessKeyPublic).parse("eyJhbGciOiJSUzUxMiIsInppcCI6IkdaSVAifQ.H4sIAAAAAAAAAHVSW2-bMBR-z69AfqxCFghpk7xUEWmrTVs3jWYvpZocfAJeie360iWr8t9nTEqBbpIfjL8L53znvAw8D1GCvIWHZgQHExJs_ABI5Efzi5mPcTT3p9k02k5nQQjBBg0rAcM7cJIr9mTAQP1KCTBN9aFCXuxDm7jCz5R4N9eJo1oEG11U9AxrypmqSPcnVVu3FCLEQpxU73QrrPHb7xxBmE1Js1iCqwaXqotXFkLcNnUtf3xc_azqahjHYctM0mesoefGTFkOemSkNNbGwShZx_FVklyvP9euR-_hfddA-jV6x8HJEKmMC2jlWE8oGPZSbcdv33OJme5H2ZHa7w0nh--Qw_61kwYxsmwAVGgt1CJNP9gjaA6c-flWpemoAMkfjc3Q3jO-a2B7gbqcNL0cnb1NrHL6Arrg9ZZ9-5rcNbE0DRMj3UATyDgjrofzsUN2eL9WOIeYG6abVpCErQRVLG2gXNI_TtzuCGUSXlekDiscB3N_bE90F44XYbiYBKOLMKp3F_aCysP_uJMO99-Trm2k5DLmBDql_PqtO99CgoQnQxXV8KmPGSm4Oi2_M0eD419NxGvUpgMAAA.TRPHb781gkoOkcbGRobauRCHmYB5mHs-Q8r9SIunm1jyeMMyCBOog16qElfNbTAgCH6eK_M4PUnUTU3vgOMpSnRSX7J5vf-WkXEP1TsIq_4YkbbLV4hB-vwocuqjVmP9PjUObEj2-G9i32UL9TgO8rfBK1TzlP1UEmabiM_mQPPH8BH7o_reQvJyqkstCcpfj8MRAsNzdSafjbsSXiEwTk4LioYPj1ysmlOGP0yqqoZn8-0dybiYspzi7GBGPj4eRFjde7icE0nOlDk5Z92uq5PL7iuR0wHd3mKjkhabCZq5V9IWGXm-OxwshAAQtCXue3nB99XAlG8c_buLpbCqaVtR-lkY9H7JC5uPNPNN3gw4oDB14rqYL1yrkNXdX4C7B5m78K6gauq-2reg6oV2O-j4k_g2DMYl5f6oi2KTto7tmmvV4HizKHBAlPd2cEuv54K-NvBwMneNZ6R6v0zgKNMGCV3ldqM_3ZwFiXarALs47e2FrbXUCeHOc1KfDFOIwUTM3O_Ulbqp6OqMFpry-alkVozePsrMGhx1z45gR1JW09bhbt9-cLruiLsTqpm2l57gnYZj0jr3Ew-OmP3TLM33vzApJQ2o4tfHGawgSYaxxxYcy3yV98kjIC-weCOYV1rpckVY0mEgAwpR4FJX1Jg_qezrkMBfxcw2flOWKd4")
        println(jwt.getBody())
    }

}
